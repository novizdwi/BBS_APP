@using Models;


@{ 
    var Id = Convert.ToInt64(Request["cbId"]);
}

@Html.DevExpress().GridView(settings =>
{

    settings.Name = "gvMaterialRequestAttachmentDetail";
    settings.KeyFieldName = "DetId";
    settings.CallbackRouteValues = new { Controller = "MaterialRequest", Action = "TabAttachmentListPartial" };
    settings.SettingsEditing.AddNewRowRouteValues = new { Controller = "MaterialRequest", Action = "TabAttachmentEditModesAddNewPartial" };
    settings.SettingsEditing.UpdateRowRouteValues = new { Controller = "MaterialRequest", Action = "TabAttachmentEditModesUpdatePartial" };
    settings.SettingsEditing.DeleteRowRouteValues = new { Controller = "MaterialRequest", Action = "TabAttachmentEditModesDeletePartial" };
    // settings.Settings.HorizontalScrollBarMode = ScrollBarMode.Auto;
    //settings.Settings.VerticalScrollBarMode = ScrollBarMode.Auto;



    settings.Columns.Add(column =>
    {
        column.Caption = "#";

        //button new tidak muncul ketika mode new
        //----------------------------------------
        //var Id = Convert.ToInt64(Request["cbId"]);
        if (ViewBag.initNew == null)
        {
            ViewBag.initNew = false;
        }
        if (((Id != 0) && (IsAjax)) || (!ViewBag.initNew))
        {
            column.SetHeaderTemplateContent(c =>
            {
                ViewContext.Writer.Write(
                   Html.DevExpress().HyperLink(settingsHL =>
                   {
                       settingsHL.Name = "gvMaterialRequestAttachmentDetail_btnNew";
                       settingsHL.NavigateUrl = "javascript:void(0)";
                       settingsHL.Properties.Text = "New Upload";
                       settingsHL.Properties.ClientSideEvents.Click = "function(s, e){gvMaterialRequestAttachmentDetail_OnClickBtnNew(); }";
                       settingsHL.Height = 20;
                   }).GetHtml()
             );
            });
        }
        else
        {
            settings.Enabled = false;
        }

        column.SetDataItemTemplateContent(c =>
        {

            ViewContext.Writer.Write(
                Html.DevExpress().HyperLink(settingsHL =>
                {
                    settingsHL.Name = "gvMaterialRequestAttachmentDetail_btnDownload_" + c.KeyValue.ToString();
                    settingsHL.NavigateUrl = Url.Action("Attachment_Download", "MaterialRequest", new { DetId = c.KeyValue });
                    settingsHL.Properties.Text = "Download";

                    settingsHL.Height = 20;
                }).GetHtml()
          );

            ViewContext.Writer.Write("&nbsp;|&nbsp;");

            ViewContext.Writer.Write(
                 Html.DevExpress().HyperLink(settingsHL =>
                 {
                     settingsHL.Name = "gvMaterialRequestAttachmentDetail_btnDelete_" + c.KeyValue.ToString();
                     settingsHL.NavigateUrl = "javascript:void(0)";
                     settingsHL.Properties.Text = "Delete";
                     settingsHL.Properties.ClientSideEvents.Click = string.Format("function(s, e) {{ gvMaterialRequestAttachmentDetail_OnClickBtnDelete({0}); }}", c.KeyValue.ToString());
                        //settingsHL.Properties.ClientSideEvents.Click = string.Format("function(s, e) { PriceComponent_OnClickBtnEdit({0}); }", c.KeyValue.ToString());
                        //settingsHL.Properties.ClientSideEvents.Click = string.Format("function(s, e) {{ PriceComponent_OnClickBtnEdit({0}); }}", new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(c.DataItem));
                        settingsHL.Height = 20;
                 }).GetHtml()
           );


        });

        column.Settings.AllowDragDrop = DefaultBoolean.False;
        column.Settings.AllowSort = DefaultBoolean.False;
        column.Width = 100;
    });


    settings.Columns.Add("Id", "Id").Visible = false;
    settings.Columns.Add("DetId", "DetId").Visible = false;

    settings.Columns.Add(column =>
    {

        column.Name = "FileName";
        column.FieldName = "FileName";
        column.Caption = "File Name";

        column.ReadOnly = true;
        column.CellStyle.BackColor = System.Drawing.Color.FromName("#E0E0E0");
        column.Width = 300;

    });
    


    settings.Settings.ShowFooter = true;

    settings.ClientSideEvents.BeginCallback = "gvMaterialRequestAttachmentDetailBeginCallback";
    //settings.ClientSideEvents.EndCallback = "gvMaterialRequestAttachmentDetailEndCallback";
    //settings.ClientSideEvents.Init = "gvMaterialRequestAttachmentDetailInit";


    settings.Settings.ShowFooter = true;
    if (ViewBag.ErrorDesc != null)
    {
        settings.SetFooterRowTemplateContent(c =>
        {
            Html.ViewContext.Writer.Write("<span style='color: red'>" + ViewBag.ErrorDesc + "</span>");
        });
    }

}).Bind(Model).GetHtml()
